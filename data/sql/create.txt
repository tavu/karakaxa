create table karakaxa_info(
     dbVersion int(10)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;


create table library_folders(
     path varchar(255) not null,
     PRIMARY KEY(path)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;

create table playlists(
     path varchar(255) not null,
     PRIMARY KEY(path)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;

select "Creating playlists table" as "Action";

create table artists(
     id int(10) not null auto_increment,
     name varchar(255) ,
     image varchar(255) ,
     unique(name) ,
     PRIMARY KEY(id)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;

select "Creating artists table" as "Action";

create table albums(
     id int(10) not null auto_increment,
     name varchar(255),
     artist int(10) not null,
     image varchar(255),
     foreign key(artist) references artists(id),
     PRIMARY KEY(id),
     unique(name,artist)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;

select "Creating albums table" as "Action";

create table genres(
     id int(10) not null auto_increment,
     name varchar(255),
     unique(name),
     PRIMARY KEY(id)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;

select "Creating genres table" as "Action";

create table composers(
     id int(10) not null auto_increment,
     name varchar(255),
     unique(name),
     PRIMARY KEY(id)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;

create table tracks(
     id int(10) not null auto_increment,
     path 		varchar(255) not null,
     title 		varchar(255),
     comment 		text ,
     lyrics 		text ,
     tracknumber 	int,
     lead_artist	int(10),
     artist		int(10),
     album 		int(10),
     genre 		int(10),
     composer 		int(10),
     year 		int,
     length 		int,
     rating 		SMALLINT,
     bitrate 		SMALLINT,
     count 		int	,

     
     foreign key (album) references albums(id)
     on delete restrict on update cascade,
     
     foreign key (genre) references genres(id)
     on delete restrict on update cascade,

     foreign key (lead_artist) references artists(id)
     on delete restrict on update cascade,

     foreign key (artist) references artists(id)
     on delete restrict on update cascade,

     foreign key (composer) references composers(id)
     on delete restrict on update cascade,

     unique(path),
     PRIMARY KEY(id)
)default charset=utf8 collate=utf8_general_ci ENGINE=myisam;


CREATE view leadArtists as select name ,id from artists;


CREATE VIEW artist_album(artist,album,image,id,artist_id,artist_image) AS
	select 
		artists.name,
		albums.name,
		albums.image,
		albums.id ,
		artists.id,
		artists.image as artist_image
	from albums
	inner join artists on artists.id=albums.artist;
 
CREATE VIEW trackView 	AS
     select
	  albums.artist 	as artist_id	,
	  albums.id			as album_id		,
	  tracknumber	 					,
	  title								,
	  albums.name		as album		,
	  artists.name		as artist		,
	  leadArtists.name	as leadArtist	,
	  comment 							,
	  genres.name   	as genre		,
	  composers.name 	as composer		,
	  length							,
	  rating 							,
	  year 								,
	  bitrate 							,
	  path								,
	  count					
	  
     from tracks,artists,albums,genres,composers,leadArtists
	  where  tracks.lead_artist=leadArtists.id
		 AND tracks.artist=artists.id
		 AND tracks.album=albums.id 
		 AND tracks.genre=genres.id 
		 AND tracks.composer=composers.id;

